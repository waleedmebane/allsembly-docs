
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Programmer’s Guide &#8212; Allsembly™ Prototype  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="GNU Free Documentation License" href="license.html" />
    <link rel="prev" title="User’s Guide" href="user_s_guide.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="programmer-s-guide">
<h1>Programmer’s Guide<a class="headerlink" href="#programmer-s-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Apache2</dt><dd><p>This is the web server.  Other web servers could be substituted.  I chose Apache because it is the premier free and open source web server.  Also, because it has mod_wsgi, it is simpler to setup for deploying Django apps.</p>
</dd>
<dt>Apache2 mod_wsgi</dt><dd><p>For interacting with Django (using the Python WSGI standard directly instead of CGI)</p>
</dd>
<dt>django</dt><dd><p>Web framework: provides user login and registration; generates the client-side HTML and javascript pages to serve in response to user actions.  (It also has its own basic webserver, which could be used to try out the Allsembly™ program without installing Apache.)</p>
</dd>
</dl>
<p>graphviz</p>
<dl class="simple">
<dt>graphviz-dev</dt><dd><p>The Python library “PyGraphviz” relies on these.  Graphviz is used to draw the graphs.</p>
</dd>
<dt>Problog</dt><dd><p>A probabilistic programming language.  This is used to compute the probabilities.</p>
</dd>
<dt>ZODB</dt><dd><p>An object database.  This is used for persistence.  It stores all of the persistent objects.  The default backend is file storage, which is currently being used.  Other storage backends could be used in the future for better scalability, see <a class="reference internal" href="#design-for-scalability"><span class="std std-ref">Design for scalability</span></a>.</p>
</dd>
<dt>PyGraphviz</dt><dd><p>Easy to use Python bindings to the Graphviz library.</p>
</dd>
<dt>RPyC</dt><dd><p>Python to Python RPC used to communicate between the Django services and the Allsembly™ server.  It could be useful later for implementing communication with a registration server.  (See <a class="reference internal" href="#design-for-confidentiality"><span class="std std-ref">Design for confidentiality</span></a>.)</p>
</dd>
<dt>persistent</dt><dd><p>This works with ZODB to automatically save and restore objects that subclass “Persistent”.</p>
</dd>
<dt>transaction</dt><dd><p>This provides a transaction manager that is used with ZODB.</p>
</dd>
<dt>atomic</dt><dd><p>This provides an atomically updatable integer class.</p>
</dd>
<dt>readerwriterlock</dt><dd><p>This provides thread synchronization using separate locks for readers and writers.  There can be multiple readers but only one writer.</p>
</dd>
<dt>python-daemon</dt><dd><p>This provides an easy API for making a Python program run as a Unix daemon.</p>
</dd>
<dt>d3.js</dt><dd><p>This is a graphics library for web clients.  I am currently only using it for pan and zoom of scalable vector graphics (SVG) that is the format of the argument graph.  It could be used to draw alternative layouts of the argument graph on the client-side if desired, especially when accompanied by <em>d3-graphviz</em>.</p>
</dd>
<dt>dialog-polyfill.js</dt><dd><p>This provides the HTML DIALOG tag and its functionality for browsers that don’t (fully) support it, yet.  The DIALOG tag is used for creating the modal dialogs.</p>
</dd>
<dt>jquery-3.6.0.js</dt><dd><p>Used to simplify AJAX calls (asynchronous loading of web content using JavaScript).</p>
</dd>
</dl>
</div>
<div class="section" id="future-possible-dependencies">
<h2>Future possible dependencies<a class="headerlink" href="#future-possible-dependencies" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>GPGME</dt><dd><p>for encrypting the stream encryption keys with the public key(s) of the admins.  (The stream encryption key will also be encrypted with the user’s hashed password.)  See more details about this in the section <a class="reference internal" href="#design-for-confidentiality"><span class="std std-ref">Design for confidentiality</span></a>, below).</p>
</dd>
<dt>PyNaCl</dt><dd><p>for stream encryption or salsa20 to encrypt a database field containing users’ anonymized ids (see more details about this in the section <a class="reference internal" href="#design-for-confidentiality"><span class="std std-ref">Design for confidentiality</span></a>, below).</p>
</dd>
<dt>Pyrsistent</dt><dd><p>to avoid mistaken call by reference-like behaviors (and, therefore, subtle bugs).</p>
</dd>
<dt>returns</dt><dd><p>to replace exceptions for error handling.</p>
</dd>
</dl>
</div>
<div class="section" id="files">
<h2>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">requirements.txt</div>
<div class="line-block">
<div class="line">List of required dependencies and their version numbers</div>
<div class="line"><br /></div>
</div>
<div class="line">setup.cfg</div>
<div class="line-block">
<div class="line">Configuration options for mypy and configuration options for Pylint</div>
<div class="line"><br /></div>
</div>
<div class="line">allsembly/</div>
<div class="line-block">
<div class="line">All of the modules of the Python package</div>
<div class="line"><br /></div>
</div>
<div class="line">django_app/</div>
<div class="line-block">
<div class="line">App for communicating with users to log them in and to generate</div>
<div class="line">the html and JavaScript of the site.  It communicates with the</div>
<div class="line">AllsemblyServer to provide the services.</div>
<div class="line"><br /></div>
</div>
<div class="line">django_site/</div>
<div class="line-block">
<div class="line">Configuration information for the Django site, which uses the</div>
<div class="line">Django app, the code for which is in the django_app directory.</div>
<div class="line"><br /></div>
</div>
<div class="line">docs/</div>
<div class="line"><br /></div>
<div class="line-block">
<div class="line">_build/</div>
<div class="line-block">
<div class="line">The Sphinx-generated HTML documentation, as a git submodule</div>
<div class="line"><br /></div>
</div>
<div class="line">conf.py</div>
<div class="line-block">
<div class="line">The Sphinx configuration file.</div>
<div class="line"><br /></div>
</div>
<div class="line">fdl-1.3.txt</div>
<div class="line-block">
<div class="line">The GNU Free Documentation License</div>
<div class="line"><br /></div>
</div>
<div class="line">index.rst</div>
<div class="line-block">
<div class="line">The main file of the documentation</div>
<div class="line"><br /></div>
</div>
<div class="line">how_it_works.md</div>
<div class="line-block">
<div class="line">This file explains how human participants contribute to making the probabilistic estimates of the truth or correctness of conclusions possible, including a contrived example.</div>
<div class="line"><br /></div>
</div>
<div class="line">make.bat</div>
<div class="line"><br /></div>
<div class="line">Makefile</div>
<div class="line-block">
<div class="line">Files for building the documentation.  Sphinx is required.</div>
<div class="line"><br /></div>
</div>
<div class="line">notes.md</div>
<div class="line-block">
<div class="line">This file contains an overview of the dialogue procedure and why it is expected to be effective, including notes about a few salient design issues.</div>
<div class="line"><br /></div>
</div>
</div>
<div class="line">LICENSE.third-party/</div>
<div class="line-block">
<div class="line">Licenses for third-party software distributed with Allsembly™</div>
<div class="line"><br /></div>
</div>
<div class="line">misc/</div>
<div class="line-block">
<div class="line">Documents containing additional explanation about what Allsembly™ is about and the theory behind it–these files are not part of the documentation, and might be edited for publication elsewhere at some point.</div>
<div class="line"><br /></div>
<div class="line">prospectus.pdf</div>
<div class="line-block">
<div class="line">This file contains a scholarly presentation of the initial development of the theory and concepts that are behind this software prototype and includes some of the motivation as well.</div>
<div class="line"><br /></div>
</div>
</div>
<div class="line">scripts/</div>
<div class="line"><br /></div>
<div class="line-block">
<div class="line">allsembly-server.py*</div>
<div class="line-block">
<div class="line">Use this script to start the Allsembly™ server.  Run it with the <code class="docutils literal notranslate"><span class="pre">--help</span></code> option to get usage information.  Also, see, the section <a class="reference internal" href="installation_and_testing.html#installation-and-testing"><span class="std std-ref">Installation and Testing</span></a> for some instructions.</div>
</div>
<div class="line">allsembly.service</div>
<div class="line-block">
<div class="line">A systemd service script example.  Modify the line “ExecStart”; then use this file to make the allsembly-server.py persistent as a daemon (i.e., make it available on system startup).</div>
<div class="line"><br /></div>
</div>
</div>
<div class="line">test/</div>
<div class="line-block">
<div class="line">The tests.</div>
<div class="line"><br /></div>
</div>
<div class="line">web/</div>
<div class="line-block">
<div class="line">scripts/</div>
<div class="line-block">
<div class="line">The javascript libraries</div>
</div>
</div>
</div>
</div>
<div class="section" id="specification-of-requirements-draft">
<h2>Specification of requirements (draft)<a class="headerlink" href="#specification-of-requirements-draft" title="Permalink to this headline">¶</a></h2>
<p>More is to be added to this section later.</p>
<p>Make all of the argumentation and discussion publicly accessible.  This will
support a secondary function of having a kind of encyclopedia of arguments
pro and con issues for repeated reference.  Users should be able to obtain an
independent URL to any part of an argument or discussion so as to refer to any specific aspect of that argument or discussion.  The data (only completely anonymous or anonymized data) should also be available in a format like Argument Interchange Format (XML-RDF) or CSV (comma-separated values), for computer assisted processing and exploration.  (Public accessibility is not currently implemented.)</p>
<p>Future requirement: provide for third-party clients; maintain a stable client interface.</p>
</div>
<div class="section" id="design-overview">
<h2>Design overview<a class="headerlink" href="#design-overview" title="Permalink to this headline">¶</a></h2>
<p class="plantuml">
<object data="_images/plantuml-b8ed7ef298ba65da0253d244ed29f474c5a80a11.svg" type="image/svg+xml" style="width:1484px;height:1611px;">
<img src="_images/plantuml-b8ed7ef298ba65da0253d244ed29f474c5a80a11.png" alt="&#64;startuml
page 1x2
caption Figure 1

package allsembly.py {
class AllsemblyServer {
-userauth_dbfilename: str
-user_dbfilename: str
-arg_dbfilename: str
-order_queue: deque[Tuple]
-graph_arg_queue: deque[Tuple]
-graph_pos_queue: deque[Tuple]
+process_all_issues_from_queue()
+process_all_orders_from_queue()
+process_all_positions_from_queue()
+process_all_items_from_all_queues()
+process_all_items_of_one_request()
+cleanup()
+server_main_loop()
}

class ServerControl {
- _should_exit: int
+ should_exit()
+ set_should_exit()
+ reset_should_exit()
}
}

ServerControl o.. AllsemblyServer


package rpyc_server.py {
class IssueQueue {
- queue: deque
+ add_issue()
+ delete_issue()
}

class GraphRequest {
+ draw()
+ get_position_details()
}

class LedgerRequest {
{field} (unused)
}


class &quot;AllsemblyServices(rpyc.Service)&quot; as AllsemblyServices {
- order_queue: deque[Tuple]
- graph_arg_queue: deque[Tuple]
- graph_pos_queue: deque[Tuple]
+ on_connect()
+ on_disconnect()
+ exposed_get_user_services()
+ exposed_authenticate_user()
- _add_issue()
}

class UserServices {
+ check_commitments_for_consistency() (unused)
+ delete_issue()
+ argue()
+ propose()
+ get_arg_graph()
+ get_position_details()
}
}

package argument_graph.py {
class Issues(Persistent) {
+ graphs: OOBTree
+ next_issue_id: AtomicLong
}

class ArgumentGraph(Persistent) {
- {static} _v_my_rwlock: RWLockWrite
- _v_my_wlock
- _v_my_rlock
+ issue_name: str
- arg_node_index: PersistentMapping
- pos_node_index: PersistentMapping
- next_arg_id: AtomicLong
- next_pos_id: AtomicLong
- read_buffer_index: int
- write_buffer_index: int
- /_v_gv_graph: AGraph
- /my_problog_prog: str
- /_v_my_g_svg: list[str]
- _add_position_to_gv_graph()
- _add_argument_to_gv_graph()
- _update_gv_graph_nodes()
- _build_initial_gv_graph()
- _add_clause_to_problog_program()
- _add_virtual_evidence_to_problog_program()
- _add_term_and_query_to_problog_program()
- _build_problog_program()
- _problog_calculate()
+ get_problog_program_string()
+ add_argument()
+ get_position_copy()
+ add_position()
+ hide_arguement() (unused)
- _prepare_graph()
+ draw_graph()
}


class PositionNode(Persistent) {
{field} ... (dataclass)
{static} build_PositionNode()
}

class ArgumentNode(Persistent) {
{field} ... (dataclass)
{static} build_ArgumentNode()
}
}

&quot;ArgumentGraph(Persistent)&quot; &quot;1..*&quot; *-- &quot;1&quot; &quot;Issues(Persistent)&quot;
&quot;PositionNode(Persistent)&quot; &quot;0..*&quot; *-- &quot;1&quot; &quot;ArgumentGraph(Persistent)&quot;
&quot;ArgumentNode(Persistent)&quot; &quot;0..*&quot; *-- &quot;1&quot; &quot;ArgumentGraph(Persistent)&quot;

&quot;Issues(Persistent)&quot; *-- AllsemblyServer: &lt;&lt;create&gt;&gt;
IssueQueue *-- AllsemblyServer: &lt;&lt;create&gt;&gt;
&quot;Issues(Persistent)&quot; o-- IssueQueue


&quot;Issues(Persistent)&quot; o-- GraphRequest


GraphRequest o-- AllsemblyServices
LedgerRequest o-- AllsemblyServices

UserServices &lt;--+ AllsemblyServices

package prob_logic.py {
class ProblogModel(Persistent) {
- {static} _v_my_rwlock: RWLockWrite
- _v_my_wlock
- _v_my_rlock
- _read_buffer_index: int
- _write_buffer_index: int
- _problog_queuy_results
- __setstate__()
+ calculate_marginals()
+ add_terms() (unused)
+ update_term_weights() (unused)
}
}

package speech_act.py {
class IndependentBid(orAsk) {
{field} ... (future fields)
}
}

package betting_exchange.py {
class BettingExchange(Persistent) {
}

class BettingMarket(Persistent) {
+ last_support_price: float
+ {field} market_id: int (same as arg_id)
}

class OrderBook(Persistent) {
- support_bids_index
- oppose_bids_index
- support_asks_index
- oppose_asks_index
+ ... () (future methods)
}

class Ledger(Persistent) {
+ index: OOBTree
==
I think there should
be only one Ledger
object (not one per
exchange)
}

class BettingContract(Persistent) {
+ {field} user1_anonid: bytes
+ {field} user2_anonid: bytes
+ purchase_price: float
+ position_locator
...
}
}

&quot;ArgumentGraph(Persistent)&quot; --* &quot;ProblogModel(Persistent)&quot;
&quot;BettingMarket(Persistent)&quot; &quot;1..*&quot; *-- &quot;1&quot; &quot;BettingExchange(Persistent)&quot;
&quot;OrderBook(Persistent)&quot; *-- &quot;BettingMarket(Persistent)&quot;

&quot;IndependentBid(orAsk)&quot; &quot;0..*&quot; *-- &quot;OrderBook(Persistent)&quot;: support_bids (or _asks)
&quot;IndependentBid(orAsk)&quot; &quot;0..*&quot; *-- &quot;OrderBook(Persistent)&quot;: oppose_bids (or _asks)

&quot;Ledger(Persistent)&quot; &quot;0..*&quot; --* &quot;BettingContract(Persistent)&quot;
&quot;Ledger(Persistent)&quot; &quot;1&quot; o-- &quot;BettingMarket(Persistent)&quot;: support_ledger_ref
&quot;Ledger(Persistent)&quot; &quot;1&quot; o-- &quot;BettingMarket(Persistent)&quot;: oppose_ledger_ref

&quot;ArgumentGraph(Persistent)&quot; --* &quot;BettingExchange(Persistent)&quot;
&#64;enduml
"/>

</object></p>
<p class="plantuml">
<object data="_images/plantuml-825b1763bd1abc31b2dfdbb0ce3fddb196c80247.svg" type="image/svg+xml" style="width:659px;height:337px;">
<img src="_images/plantuml-825b1763bd1abc31b2dfdbb0ce3fddb196c80247.png" alt="&#64;startuml
caption Figure 2
UserAgent -&gt; &quot;Django app&quot;: Authentication request

alt sucessful authentication

    UserAgent -&gt; &quot;Django app&quot;: service request with logged in session
    &quot;Django app&quot; -&gt; AllsemblyServices: service request
    AllsemblyServices -&gt; &quot;Django app&quot;: response (for some services)
    &quot;Django app&quot; -&gt; UserAgent: response

else authentication failed
    &quot;Django app&quot; -&gt; UserAgent: Redirect to login page with error message

end
&#64;enduml
"/>

</object></p>
<p>The client-side code is generated by the Django templates in django_app/templates according to the code in django_app/views.py.</p>
<p>It communicates with the Allsembly™ server using RPC (provided by the RPyC library).  The code on the Allsembly™ server side is in the rpyc_server.py module, especially the AllsemblyServices class.</p>
<p>The interaction proceeds as shown in Figure 2, above.  Currently, since there is no interaction between users–each user is in a kind of <em>sandbox</em> of its own–which graph to display is dependent on which user is logged it (i.e., the userid in the encrypted login cookie).</p>
<p>The UserServices object is used to provide each of the specific services that require login, and it is provided with a login username by the django_app, which must have logged in the user.  In most cases, the request is just added to a queue.  The AllsemblyServices RPyC server object is running its event loop in a separate thread from the server main loop.</p>
<p>The server main loop, allsembly.allsembly.AllsemblyServer.server_main_loop(), is started by the script, “scripts/allsembly-server.py”, and it, in turn, starts the RPyC service in a separate thread.  In the main loop, each queue is checked and the requests there are processed.  Most of the processing involves calling functions in an ArgumentGraph object.  There is a separate ArgumentGraph object for each graph and it is stored in a mapping that is persisted in the database.  The ArgumentGraph object draws a new graph and calculates new probabilities with each client request that changes the graph.  Currently, after the client makes a request that changes the graph, it immediately after that requests a new drawn graph.  The intention is that in a future version, the client would be subscribed to a server sent events or websockets channel or be waiting on a long poll, to learn when a new graph is ready to be loaded.</p>
</div>
<div class="section" id="class-detail">
<h2>Class detail<a class="headerlink" href="#class-detail" title="Permalink to this headline">¶</a></h2>
<p>For now this section just contains the docstrings from the modules.</p>
<div class="section" id="module-allsembly.allsembly">
<span id="allsembly-module"></span><h3><strong>allsembly</strong> module<a class="headerlink" href="#module-allsembly.allsembly" title="Permalink to this headline">¶</a></h3>
<p>allsembly.py
Module for building the Allsembly™ server</p>
<p>The server will be a script that reads
in the configuration and then calls
the server main loop function in this
module.  (See scripts/allsembly-server.py)</p>
<p>Overview:
Allow users to contribute to an unfolding policy deliberation 
and obtain updates of the changes made by others.</p>
<p>Users contribute <em>arguments</em>, which are sets of statements
that support or rebut other statements added earlier.</p>
<p>Comprehending subjective beliefs in statements as evidence
of their truth, the software estimates the truth of statements
using a Bayesian network that is constructed implicitly using
the Problog module (a probabilistic logic programming
language).</p>
<p>In order to obtain the prior probabilities, the software needs
to aggregate the judgements of the users, and it does that
using betting markets.  A betting market elicits something close
to the true belief in the truth value of the statement being
bet on because, if the user is rational, they adjust their 
risk to their beliefs.  (Although, of course, different users
may have different risk tolerances.)
NOTE: The betting market code is not fully implemented, and it
is not used by the current server.  Instead the server serves
a client in a single user (“sandboxed”) mode and accepts whatever
their bid is as the price.  So the user can manually simulate
what would happen if the price were thus and so.</p>
<p>The software will implement a betting exchange containing one
market for every set of statements that is separately 
contestable.  The markets use limit order books implemented
as pairs of priority queues.  More details will be in the
external documentation, and some details can be found in the
docstrings of the betting_exchange module.</p>
<p>This implements a server that provides the following services:
User’s may connect to the server and:
Contribute new statements and policy proposals
Attempt to buy (bid on) betting contracts
Get updates on the current state of the deliberation,</p>
<blockquote>
<div><p>including new contributions, current prices, and estimates
of the truth value of sets of statements.</p>
</div></blockquote>
<dl class="py class">
<dt id="allsembly.allsembly.AllsemblyServer">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.allsembly.</span></code><code class="sig-name descname"><span class="pre">AllsemblyServer</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user_dbfilename</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg_dbfilename</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.allsembly.AllsemblyServer" title="Permalink to this definition">¶</a></dt>
<dd><p>server_main_loop function starts the server
I put it in a class so that its data can be saved
to be inspected after the server exits.
It could also be inspected while the server is
running if the caller is in a separate thread and
uses locks to synchronize access</p>
<dl class="py method">
<dt id="allsembly.allsembly.AllsemblyServer.check_timeout">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">check_timeout</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeout_msec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time_msec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time_msec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.allsembly.AllsemblyServer.check_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience function:
Return true if the difference between end_time_msec
and start_time_msec is greater than or equal to timeout_msec
indicating that the timeout has expired;
Otherwise, return false.</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.allsembly.AllsemblyServer.server_main_loop">
<code class="sig-name descname"><span class="pre">server_main_loop</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">update_nofication_fileobj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">TextIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server_control</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.allsembly.ServerControl" title="allsembly.allsembly.ServerControl"><span class="pre">allsembly.allsembly.ServerControl</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">listen_port</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">listen_address</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'::1'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ipv6</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">int</span><a class="headerlink" href="#allsembly.allsembly.AllsemblyServer.server_main_loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Call this function to start the server.
Starts an RPyC (Python to Python RPC) service.
Loops, processing requests, until calling process</p>
<blockquote>
<div><p>signals it to stop by setting server_control._should_exit.</p>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="allsembly.allsembly.ServerControl">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.allsembly.</span></code><code class="sig-name descname"><span class="pre">ServerControl</span></code><a class="headerlink" href="#allsembly.allsembly.ServerControl" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this to tell the server_main_loop to exit,
by setting “should_exit” by calling set_should_exit().
If you run server_main_loop from a separate thread,
use ServerControlThreadSafe instead.
If you re-run a server after it exits, you may need
to reset “should_exit” first by calling
reset_should_exit().  That is not currently necessary in
AllsemblyServer.server_main_loop(…).
A server should call should_exit() periodically, such as in
a main while loop, to check whether it should exit.</p>
</dd></dl>

<dl class="py function">
<dt id="allsembly.allsembly.process_one_argument_from_queue">
<code class="sig-prename descclassname"><span class="pre">allsembly.allsembly.</span></code><code class="sig-name descname"><span class="pre">process_one_argument_from_queue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issues</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.Issues" title="allsembly.argument_graph.Issues"><span class="pre">allsembly.argument_graph.Issues</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_arg_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.GraphUpdateArgQueue" title="allsembly.rpyc_server.GraphUpdateArgQueue"><span class="pre">allsembly.rpyc_server.GraphUpdateArgQueue</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.OrderQueue" title="allsembly.rpyc_server.OrderQueue"><span class="pre">allsembly.rpyc_server.OrderQueue</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.allsembly.process_one_argument_from_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if graph_arg_queue is not empty
after processing one item from the queue;
False otherwise</p>
</dd></dl>

<dl class="py function">
<dt id="allsembly.allsembly.process_one_issue_from_queue">
<code class="sig-prename descclassname"><span class="pre">allsembly.allsembly.</span></code><code class="sig-name descname"><span class="pre">process_one_issue_from_queue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issues</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.Issues" title="allsembly.argument_graph.Issues"><span class="pre">allsembly.argument_graph.Issues</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">issue_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">allsembly.rpyc_server.IssueQueue</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.allsembly.process_one_issue_from_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if issue_queue is not empty after
processing one item from the queue;
False otherwise</p>
</dd></dl>

<dl class="py function">
<dt id="allsembly.allsembly.process_one_order_from_queue">
<code class="sig-prename descclassname"><span class="pre">allsembly.allsembly.</span></code><code class="sig-name descname"><span class="pre">process_one_order_from_queue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issues</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.Issues" title="allsembly.argument_graph.Issues"><span class="pre">allsembly.argument_graph.Issues</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.OrderQueue" title="allsembly.rpyc_server.OrderQueue"><span class="pre">allsembly.rpyc_server.OrderQueue</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.allsembly.process_one_order_from_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if order_queue is not empty
after processing one item from the queue;
False otherwise</p>
</dd></dl>

<dl class="py function">
<dt id="allsembly.allsembly.process_one_position_from_queue">
<code class="sig-prename descclassname"><span class="pre">allsembly.allsembly.</span></code><code class="sig-name descname"><span class="pre">process_one_position_from_queue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issues</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.Issues" title="allsembly.argument_graph.Issues"><span class="pre">allsembly.argument_graph.Issues</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_pos_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.GraphUpdatePosQueue" title="allsembly.rpyc_server.GraphUpdatePosQueue"><span class="pre">allsembly.rpyc_server.GraphUpdatePosQueue</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.allsembly.process_one_position_from_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if graph_pos_queue is not empty
after processing one item from the queue;
False otherwise</p>
</dd></dl>

</div>
<div class="section" id="module-allsembly.rpyc_server">
<span id="rpyc-server-module"></span><h3><strong>rpyc_server</strong> module<a class="headerlink" href="#module-allsembly.rpyc_server" title="Permalink to this headline">¶</a></h3>
<p>Provides the Allsembly services via RPC.
The AllsemblyServices class is an RPyC (RPC server) which can be</p>
<blockquote>
<div><p>started to provide the services.</p>
</div></blockquote>
<dl class="simple">
<dt>And it needs to be provided with queues onto which to place</dt><dd><p>the requests that will be handled elsewhere.
(See the module “allsembly”.)</p>
</dd>
<dt>The caller maintains its own reference to the queues and reads</dt><dd><p>off each request to handle it.</p>
</dd>
<dt>Some requests directly get information; These are mediated through</dt><dd><p>GraphRequest and LedgerRequest instances and IssuesQueue, which should
perhaps be renamed to IssuesRequest.  Only GraphRequest and IssuesQueue
are currently implemented.  A GraphRequest object can provide a drawn
graph and the full text of a position.  In addition to adding an issue
to the queue, the IssueQueue can provide the id of the next issue that
will be used to identify it in the database and for any other requests
referencing it.</p>
</dd>
<dt>The RPyC server is threaded, so multiple threads might try to access</dt><dd><p>information at the same time.  That is the reasond for mediation of
the requests through thread safe queues and request objects.</p>
</dd>
</dl>
<dl class="py class">
<dt id="allsembly.rpyc_server.AllsemblyServices">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">AllsemblyServices</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.OrderQueue" title="allsembly.rpyc_server.OrderQueue"><span class="pre">allsembly.rpyc_server.OrderQueue</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_arg_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.GraphUpdateArgQueue" title="allsembly.rpyc_server.GraphUpdateArgQueue"><span class="pre">allsembly.rpyc_server.GraphUpdateArgQueue</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_pos_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.GraphUpdatePosQueue" title="allsembly.rpyc_server.GraphUpdatePosQueue"><span class="pre">allsembly.rpyc_server.GraphUpdatePosQueue</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">issue_queue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">allsembly.rpyc_server.IssueQueue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_req</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.GraphRequest" title="allsembly.rpyc_server.GraphRequest"><span class="pre">allsembly.rpyc_server.GraphRequest</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ledger_req</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.LedgerRequest" title="allsembly.rpyc_server.LedgerRequest"><span class="pre">allsembly.rpyc_server.LedgerRequest</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a user with the services through
remote procedure calls (RPC)</p>
<dl class="py exception">
<dt id="allsembly.rpyc_server.AllsemblyServices.NotAuthenticated">
<em class="property"><span class="pre">exception</span> </em><code class="sig-name descname"><span class="pre">NotAuthenticated</span></code><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.NotAuthenticated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">UserServices</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">services</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.rpyc_server.AllsemblyServices" title="allsembly.rpyc_server.AllsemblyServices"><span class="pre">allsembly.rpyc_server.AllsemblyServices</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">userid</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bytes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide services requiring user authentication.
An instance can only be created by providing authentic
credentials.  Otherwise, the exception
“AllsemblyServices.NotAuthenticated” is raised.</p>
<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices.argue">
<code class="sig-name descname"><span class="pre">argue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subuser</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">argument</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bytes</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices.argue" title="Permalink to this definition">¶</a></dt>
<dd><p>Always returns True.
Just puts the request on the queue.</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices.check_commitments_for_consistency">
<code class="sig-name descname"><span class="pre">check_commitments_for_consistency</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices.check_commitments_for_consistency" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices.delete_issue">
<code class="sig-name descname"><span class="pre">delete_issue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices.delete_issue" title="Permalink to this definition">¶</a></dt>
<dd><p>attempt to delete a presumably existing issue.
No feedback given regarding failure or success.
This function just puts the request on the queue.</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices.get_arg_graph">
<code class="sig-name descname"><span class="pre">get_arg_graph</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices.get_arg_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the argument graph as a string.
Currently that is a Graphviz produced graph in SVG format.
See ArgumentGraph.draw_graph(…) in the argument_graph
module, called via GraphRequest.</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices.get_next_arg_graph">
<code class="sig-name descname"><span class="pre">get_next_arg_graph</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_graph_revision_number</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices.get_next_arg_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the argument graph (svg string) and the graph revision 
number on success or an error code on failure:
1, if the call to get the graph returned early with no graph
2, if the call timed out.
TODO: use an enumeration instead of an int for the error codes.</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices.get_position_details">
<code class="sig-name descname"><span class="pre">get_position_details</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices.get_position_details" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the full text of a position.</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.UserServices.propose">
<code class="sig-name descname"><span class="pre">propose</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subuser</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proposal</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bytes</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.UserServices.propose" title="Permalink to this definition">¶</a></dt>
<dd><p>Always returns True.
Just puts the request on the queue.</p>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.on_connect">
<code class="sig-name descname"><span class="pre">on_connect</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.on_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>called when the connection is established</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AllsemblyServices.on_disconnect">
<code class="sig-name descname"><span class="pre">on_disconnect</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#allsembly.rpyc_server.AllsemblyServices.on_disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>called when the connection had already terminated for cleanup
(must not perform any IO on the connection)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.AuthCredentials">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">AuthCredentials</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">userid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.AuthCredentials" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="allsembly.rpyc_server.AuthCredentials.password">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">password</span></code><a class="headerlink" href="#allsembly.rpyc_server.AuthCredentials.password" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AuthCredentials.userid">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">userid</span></code><a class="headerlink" href="#allsembly.rpyc_server.AuthCredentials.userid" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.AuthCredentialsStr">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">AuthCredentialsStr</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">userid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.AuthCredentialsStr" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="allsembly.rpyc_server.AuthCredentialsStr.password">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">password</span></code><a class="headerlink" href="#allsembly.rpyc_server.AuthCredentialsStr.password" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.AuthCredentialsStr.userid">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">userid</span></code><a class="headerlink" href="#allsembly.rpyc_server.AuthCredentialsStr.userid" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.GraphRequest">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">GraphRequest</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issues_from_db</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.IssuesDBAccessor" title="allsembly.argument_graph.IssuesDBAccessor"><span class="pre">allsembly.argument_graph.IssuesDBAccessor</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">issues_obj_not_safe_to_write</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.Issues" title="allsembly.argument_graph.Issues"><span class="pre">allsembly.argument_graph.Issues</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.GraphRequest" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a thread-safe way to get data from the argument
graph.
In particular, use this to draw the SVG representation
of the graph or get the pre-drawn SVG.</p>
<dl class="py class">
<dt id="allsembly.rpyc_server.GraphRequest.ErrCodes">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">ErrCodes</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.GraphRequest.ErrCodes" title="Permalink to this definition">¶</a></dt>
<dd><p>An enumeration.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.GraphRequest.Error">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">Error</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">‘GraphRequest.ErrCodes’</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.GraphRequest.Error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.GraphUpdateArgQueue">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">GraphUpdateArgQueue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event_obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">threading.Event</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.GraphUpdateArgQueue" title="Permalink to this definition">¶</a></dt>
<dd><p>wraps a deque allowing us to pass an optional Event object to
notify another thread when items have been added and are,
therefore, ready for processing.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.GraphUpdatePosQueue">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">GraphUpdatePosQueue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event_obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">threading.Event</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.GraphUpdatePosQueue" title="Permalink to this definition">¶</a></dt>
<dd><p>wraps a deque allowing us to pass an optional Event object to
notify another thread when items have been added and are,
therefore, ready for processing.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.LedgerRequest">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">LedgerRequest</span></code><a class="headerlink" href="#allsembly.rpyc_server.LedgerRequest" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a thread-safe way to get ledger data from the
betting exchange.
The ledger contains all previous bets and bids.
Use this to get a user’s commitment store (bets and bids).
Gets a read lock on the ledger data.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.OrderQueue">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">OrderQueue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event_obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">threading.Event</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.OrderQueue" title="Permalink to this definition">¶</a></dt>
<dd><p>wraps a deque allowing us to pass an optional Event object to
notify another thread when items have been added and are,
therefore, ready for processing.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.rpyc_server.UserInfoAndCookie">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.rpyc_server.</span></code><code class="sig-name descname"><span class="pre">UserInfoAndCookie</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user_settings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encrypted_cookie</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.rpyc_server.UserInfoAndCookie" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="allsembly.rpyc_server.UserInfoAndCookie.encrypted_cookie">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">encrypted_cookie</span></code><a class="headerlink" href="#allsembly.rpyc_server.UserInfoAndCookie.encrypted_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.rpyc_server.UserInfoAndCookie.user_settings">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">user_settings</span></code><a class="headerlink" href="#allsembly.rpyc_server.UserInfoAndCookie.user_settings" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="demo-module">
<h3><strong>demo</strong> module<a class="headerlink" href="#demo-module" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="module-allsembly.user">
<span id="user-module"></span><h3><strong>user</strong> module<a class="headerlink" href="#module-allsembly.user" title="Permalink to this headline">¶</a></h3>
<p>Classes containing user data, currently unused.</p>
<dl class="py class">
<dt id="allsembly.user.UserClientSettings">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.user.</span></code><code class="sig-name descname"><span class="pre">UserClientSettings</span></code><a class="headerlink" href="#allsembly.user.UserClientSettings" title="Permalink to this definition">¶</a></dt>
<dd><p>Future place for storing a user’s web client
settings.</p>
</dd></dl>

</div>
<div class="section" id="module-allsembly.argument_graph">
<span id="argument-graph-module"></span><h3><strong>argument_graph</strong> module<a class="headerlink" href="#module-allsembly.argument_graph" title="Permalink to this headline">¶</a></h3>
<p>Contains classes and functions for building arguments and for
representing them in a graph, and also for representing a graph visually
(currently by using GraphViz to produce an scalable vector graphics string).
These classes and functions are used by the allsembly module.
The functions to build arguments and insert them into the graph are</p>
<blockquote>
<div><p>called in the allsembly module in response to requests made by users
through the RPC module, “rpyc_server”, which in turn come through
the WSGI server in the demo module, which in turn come through the
web server initiated by the client code in the web directory of this package,
“web/allsembly_demo.xsl”.</p>
</div></blockquote>
<dl class="py class">
<dt id="allsembly.argument_graph.ArgumentGraph">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.argument_graph.</span></code><code class="sig-name descname"><span class="pre">ArgumentGraph</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue_name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.argument_graph.ArgumentGraph" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores all of the arguments for an <em>issue</em> and generates
the visual representation of the graph using PyGraphViz
and the probabilistic logic program representation using
Problog.</p>
<dl class="py method">
<dt id="allsembly.argument_graph.ArgumentGraph.add_argument">
<code class="sig-name descname"><span class="pre">add_argument</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argument</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.ArgumentNode" title="allsembly.argument_graph.ArgumentNode"><span class="pre">allsembly.argument_graph.ArgumentNode</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#allsembly.argument_graph.ArgumentGraph.add_argument" title="Permalink to this definition">¶</a></dt>
<dd><p>Enter a new argument into the arg_node_index
And return its id number</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.argument_graph.ArgumentGraph.add_position">
<code class="sig-name descname"><span class="pre">add_position</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">position</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.argument_graph.PositionNode" title="allsembly.argument_graph.PositionNode"><span class="pre">allsembly.argument_graph.PositionNode</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#allsembly.argument_graph.ArgumentGraph.add_position" title="Permalink to this definition">¶</a></dt>
<dd><p>Enter a new position into the pos_node_index
And return its id number.
For the convenience of producing the drawn argument
graph/diagram as a tree, the positions that are
the same are duplicated in the graph.
However, just one should be referred to in the
BettingExchange and in the Problog model.
So, for each position node, a list is kept of other
position nodes that represent the same position.
The one with the smallest pos_id will be used by
the BettingExchange and the Problog model.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="allsembly.argument_graph.ArgumentNode">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.argument_graph.</span></code><code class="sig-name descname"><span class="pre">ArgumentNode</span></code><a class="headerlink" href="#allsembly.argument_graph.ArgumentNode" title="Permalink to this definition">¶</a></dt>
<dd><p>An argument which has as its conclusion either that its
parent is true (when self.supports_conclusion is true) or
that its parent is false</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.argument_graph.Issues">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.argument_graph.</span></code><code class="sig-name descname"><span class="pre">Issues</span></code><a class="headerlink" href="#allsembly.argument_graph.Issues" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores argument graphs for all issues.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.argument_graph.IssuesDBAccessor">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.argument_graph.</span></code><code class="sig-name descname"><span class="pre">IssuesDBAccessor</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">ZODB.DB.DB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_only</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.argument_graph.IssuesDBAccessor" title="Permalink to this definition">¶</a></dt>
<dd><p>Instantiate one of these with a ZODB database object and pass it
to another thread or threads.
In the other thread(s) obtain an issues object from the database
using the context manager by calling get_context() as part of
a ‘with’ statement, e.g.:</p>
<p>… # set backend
db = ZODB.DB(my_backend)
issue_access = IssuesDBAccessor(db)
… # pass issue_access into thread class and start thread
# in new thread (‘my_iss_access’ is a local variable corresponding to
# ‘issue_access’)
with my_iss_access.get_context() as issues:</p>
<blockquote>
<div><p>diagram_svg: str = issues.graph[issue_id].get_drawn_graph()</p>
</div></blockquote>
</dd></dl>

<dl class="py class">
<dt id="allsembly.argument_graph.PositionNode">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.argument_graph.</span></code><code class="sig-name descname"><span class="pre">PositionNode</span></code><a class="headerlink" href="#allsembly.argument_graph.PositionNode" title="Permalink to this definition">¶</a></dt>
<dd><p>A premise or a conclusion of an argument</p>
</dd></dl>

</div>
<div class="section" id="module-allsembly.prob_logic">
<span id="prob-logic-module"></span><h3><strong>prob_logic</strong> module<a class="headerlink" href="#module-allsembly.prob_logic" title="Permalink to this headline">¶</a></h3>
<p>Interface to the probabilistic logic code (currently using
the Problog python package).</p>
<dl class="py class">
<dt id="allsembly.prob_logic.ProblogModel">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.prob_logic.</span></code><code class="sig-name descname"><span class="pre">ProblogModel</span></code><a class="headerlink" href="#allsembly.prob_logic.ProblogModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Problog terms and rules that model the argument graph
and allow Problog to do the inference.</p>
<p>Note that the current Problog models (constructed in ArgumentGraph 
methods, _add_clause_to_problog_program(), 
_add_virtual_evidence_to_problog_program(), and
_add_term_and_query_to_problog_program())
are not necessarily the best for all 
kinds of arguments.  The For example, the inference in causal arguments 
might only go in one direction.  Dealing most appropriately with 
all major types is a longer-term goal.</p>
<dl class="py method">
<dt id="allsembly.prob_logic.ProblogModel.add_terms">
<code class="sig-name descname"><span class="pre">add_terms</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_terms</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#allsembly.prob_logic.ProblogModel.add_terms" title="Permalink to this definition">¶</a></dt>
<dd><p>updates the model from string</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.prob_logic.ProblogModel.calculate_marginals">
<code class="sig-name descname"><span class="pre">calculate_marginals</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#allsembly.prob_logic.ProblogModel.calculate_marginals" title="Permalink to this definition">¶</a></dt>
<dd><p>calculates the posterior probabilities</p>
</dd></dl>

<dl class="py method">
<dt id="allsembly.prob_logic.ProblogModel.update_term_weights">
<code class="sig-name descname"><span class="pre">update_term_weights</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">updated_weights</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#allsembly.prob_logic.ProblogModel.update_term_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>updates model weights from dict</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-allsembly.betting_exchange">
<span id="betting-exchange-module"></span><h3><strong>betting_exchange</strong> module<a class="headerlink" href="#module-allsembly.betting_exchange" title="Permalink to this headline">¶</a></h3>
<p>Classes representing the betting exchanges.  Not fully implemented.
These are not used in the current version.
There will be one exchange per ‘issue’ containing one</p>
<blockquote>
<div><p>market per position.</p>
</div></blockquote>
<dl class="simple">
<dt>An order book (see <a class="reference external" href="https://en.wikipedia.org/wiki/Order_book">https://en.wikipedia.org/wiki/Order_book</a> and</dt><dd><p><a class="reference external" href="https://www.5minutefinance.org/concepts/the-limit-order-book">https://www.5minutefinance.org/concepts/the-limit-order-book</a>) is used
to keep track of bids.  It works like an ‘auction market’ (see
<a class="reference external" href="https://www.investopedia.com/terms/a/auctionmarket.asp">https://www.investopedia.com/terms/a/auctionmarket.asp</a>). Since this
is a betting market, both sides of a sale make bids, but one side bids
to place a bet on success and the other side bids to place a bet on
failure.  A betting contract can be made between bettors agreeing on
price (i.e. price “p” for success and price “1-p” for failure).
Ordinarily, this means:
if I am bidding on success, I will pay you “1” if there is failure
and you will pay me “1” if there is success.</p>
</dd>
<dt>These markets are different.  There can be partial success and failure.</dt><dd><p>The contracts mean the following.
For success (i.e., the final estimation of the probability of truth of
a position): I am bidding on success, which means a final estimate that
is greater than or equal to my bid; I will pay you the amount of the
shortfall.  You are bidding on failure, which means a final estimate
that is less than or equal to your bid.  You will pay me the amount
by which the final estimate exceeds your bid.
For example, if I bet 70 “cents” to your 30 “cents”, and the final
estimate is 50 “cents”, I pay you 20 “cents”.  If the final estimate
is 80 “cents”, you pay me 10 “cents”.  You stand to lose at most 30
“cents”, and I stand to lose at most 70 “cents”, but if the market
price was 70 “cents” that indicates a high probability of success;
the odds are in my favor and my low risk is mitigated by a high price
and your high risk is mitigated by a low price.</p>
</dd>
<dt>There are special conditions needed for price to correspond</dt><dd><p>with probability of success.
Participants cannot be withholding information that, if known, would
swing the estimate.  That is, if I know a decisive reason why a position
that currently has a high price is actually false, no one else knows it,
and I wait until the near the end of the exercise to share it, then
all along, the price was very wrong as an indicator of the probability
of success.  However, the market is supposed to give participants an
incentive to share their best evidence early.  They cannot know that
no one else knows it, and they know that others have an incentive to
investigate and find it out, in any case.  So, their best chance of
getting the benefit (in the form of ‘profit’) from their knowledge is
to share it early.  If that happens, then the price might swing a lot
early in the trading, but later stabilize.  This does not mean that the
position is probably true or that no decisive reason that it is false
exists.  But it is probably true to the best of the knowledge of the
group and of their ability to learn relevant pro and con evidence in the
time allotted.
The “Efficient Market Hypothesis” and related empirical results seeming
to confirm it says some of what I wrote above in a different way.
I also think I see a reasonable analogy with the way that scientists get
credit for their work by publishing it.  They have an incentive to
publish before others working on similar projects (or so I understand);
they cannot change the estimate, accepted within the community, of the
probability of the truth of theories in any other way than by offering
evidence (in an ideal characterization); and that evidence is presented
publicly and peer reviewed.</p>
</dd>
</dl>
<p>A “ledger” keeps track of the bets.
There will also be a secondary market, integrated with the primary market.</p>
<blockquote>
<div><p>Participants may change their minds.  In that case they would want to
sell their contracts.  That market has both buyers and sellers, not only
buyers, just like the securities exchange markets.  A seller will issue
an “ask” and it can be matched with any bid.  In other words, as a buyer
I might buy a new contract made with another buyer who is buying the
opposite position from me (e.g., “failure” to my purchase of “success”),
or I might buy out someone else’s obligations in an existing contract
(e.g. they’d bet “success” previously and now want to sell, and I can
take over their bet of “success” at a new price, possibly lower than what
they paid).  In that case, it is useful to look at it as though they
have ‘ante’d up’ their betting contract price.  If they paid 70 cents,
and I buy their contract for 60 cents, their 10 cents remains with
the contract.  The contract will still pay up to 70 cents to the other
bettor on the contract, but 10 cents comes from the previous contract
owner before any money is taken from me.  So I break even at 60 cents
which is the same as if I’d purchased a new contract for 60 cents.
Suppose, again, that the original bettor paid 70 cents, but this time
I buy their contract for 80 cents.  I still only have an obligation
to pay the other bettor on the contract up to 70 cents, and I stand
to win up to 30 cents, but I have already paid 10 cents to the
original bettor (and they received ‘back’, in essence, their ante’d
sum of 70 cents, which I replaced). So I only break even at 80 cents.
And I stand to gain only up to 20 cents on net, which is the same
as if I’d purchased a new contract for 80 cents.
In terms of accounting, though, I don’t think I would want to
modify the ids of the parties on the ‘contract’ written in the
ledger.  Instead I think there should be a line indicating that
it was sold and to whom and for how much.  To find out the current
owner, we would work our way forward through the chain of sales,
or to start from a current owner and find out which contract
they are obligated under: first find the sale item with the presumed
current owner’s id; check that there is no later sale, then find
the mentioned contract id number.</p>
</div></blockquote>
<dl class="simple">
<dt>Purchasing or selling a betting contract depends on there being a</dt><dd><p>counterpart ready to sell/buy such a contract.  In a large enough
market, that condition might be normally, or constantly, met.
In markets, in general, there are
often _market-<a href="#id1"><span class="problematic" id="id2">makers_</span></a>, and in betting situations, there are
often _book-<a href="#id3"><span class="problematic" id="id4">makers_</span></a> who contract for bets using a guess as
to their value plus an integrated small transaction cost.  The
book-maker takes the risk of getting stuck with a contract not worth
its value and having to pay out in order to broker sales and make
money from the transaction markup.  The book-maker or market-maker
benefits the market by adding liquidity.  There will generally always
be someone to buy from or sell to at reasonable terms even if that
someone is the book-/market- maker rather than another person
intrinsically interested in the betting outcome.  Using “Hanson’s
market scoring rule”, a market-maker for betting markets could be
automated, and that is described in a paper: Berg, Henry and Todd A.
Proebsting (2009), “Hanson’s Automated Market Maker”, _Journal of
Prediction <a href="#id5"><span class="problematic" id="id6">Markets_</span></a>, Vol. 3, Iss. 1, pp. 45-59.</p>
</dd>
</dl>
<dl class="py class">
<dt id="allsembly.betting_exchange.BettingExchange">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.betting_exchange.</span></code><code class="sig-name descname"><span class="pre">BettingExchange</span></code><a class="headerlink" href="#allsembly.betting_exchange.BettingExchange" title="Permalink to this definition">¶</a></dt>
<dd><p>A container for all of the markets.
There is only one per issue.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.betting_exchange.OrderBook">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.betting_exchange.</span></code><code class="sig-name descname"><span class="pre">OrderBook</span></code><a class="headerlink" href="#allsembly.betting_exchange.OrderBook" title="Permalink to this definition">¶</a></dt>
<dd><p>Order book matching algorithm matches highest bids on each side
(support or oppose) for pareto optimal matching.
See <a class="reference external" href="https://blogs.cornell.edu/info4220/2016/03/17/nyse-automated-matching-algorithm/">https://blogs.cornell.edu/info4220/2016/03/17/nyse-automated-matching-algorithm/</a>
For that purpose, each side’s orders are stored in priority
queues.  (Lists will be made into priority queues using the
algorithm from the heapq module of the Python standard library.)
Re-sale of old betting contracts is accommodated by having</p>
<blockquote>
<div><p>separate seller queues (self.support_asks and self.oppose_asks).</p>
</div></blockquote>
<dl class="simple">
<dt>Since sellers cannot sell to other sellers, the order book needs</dt><dd><p>to keep track of sellers separately from buyers.  There will be
four queues: bids for support contracts, bids for oppose contracts,
offers for support contracts, offers for oppose contracts.  Bids for
support contracts can be matched with bids for oppose contracts to
enter the parties into a new contract or with support offers to transfer
an old contract, and correspondingly with bids for oppose contracts
and their counterparts.</p>
</dd>
</dl>
<p>A user also may not buy from or sell to self.</p>
</dd></dl>

</div>
<div class="section" id="module-allsembly.speech_act">
<span id="speech-act-module"></span><h3><strong>speech_act</strong> module<a class="headerlink" href="#module-allsembly.speech_act" title="Permalink to this headline">¶</a></h3>
<p>Classes for representing the kinds of actions that a participant
can take in a dialogue.  These are used in user requests to the
Allsembly server.  They will correspond to the formal dialogue
specification, which is not yet included with the source package.
The formal specification currently exists only as an early draft.</p>
<dl class="py class">
<dt id="allsembly.speech_act.ArgueSpeechAct">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">ArgueSpeechAct</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argument</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.Argument" title="allsembly.speech_act.Argument"><span class="pre">allsembly.speech_act.Argument</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.ArgueSpeechAct" title="Permalink to this definition">¶</a></dt>
<dd><p>Request for adding an argument into the
argument graph.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.Argument">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">Argument</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pro_or_con</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.ProOrCon" title="allsembly.speech_act.ProOrCon"><span class="pre">allsembly.speech_act.ProOrCon</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_premise</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.Premise" title="allsembly.speech_act.Premise"><span class="pre">allsembly.speech_act.Premise</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_position</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.UnconcededPosition" title="allsembly.speech_act.UnconcededPosition"><span class="pre">allsembly.speech_act.UnconcededPosition</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">bid_on_target</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.Bid" title="allsembly.speech_act.Bid"><span class="pre">allsembly.speech_act.Bid</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">argument_about_first_premise</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.ChainArgument" title="allsembly.speech_act.ChainArgument"><span class="pre">allsembly.speech_act.ChainArgument</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remaining_premises</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.Premise" title="allsembly.speech_act.Premise"><span class="pre">allsembly.speech_act.Premise</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.ChainArgument" title="allsembly.speech_act.ChainArgument"><span class="pre">allsembly.speech_act.ChainArgument</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.Argument" title="Permalink to this definition">¶</a></dt>
<dd><p>Required elements of an argument for an
ArgueSpeechAct</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.Ask">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">Ask</span></code><a class="headerlink" href="#allsembly.speech_act.Ask" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents an offer to sell an existing bidding
contract held by the user-owner.
Not implemented yet.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.Bid">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">Bid</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_price</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_price</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amount</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.Bid" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents an offer to buy a bidding contract.
Bid prices should be between 0 and 1 in certain
increments (e.g., .001).
Which position it is for and whether it is
pro or con the position is determined by
context.
If it is a bid on the conclusion of an argument,
it will have the same pro/con value as the
argument.
If it is a bid on a premise, it will be a
pro bid.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.ChainArgument">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">ChainArgument</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pro_or_con</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.ProOrCon" title="allsembly.speech_act.ProOrCon"><span class="pre">allsembly.speech_act.ProOrCon</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_premise</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.Premise" title="allsembly.speech_act.Premise"><span class="pre">allsembly.speech_act.Premise</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">argument_about_first_premise</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.ChainArgument" title="allsembly.speech_act.ChainArgument"><span class="pre">allsembly.speech_act.ChainArgument</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remaining_premises</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.Premise" title="allsembly.speech_act.Premise"><span class="pre">allsembly.speech_act.Premise</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.ChainArgument" title="allsembly.speech_act.ChainArgument"><span class="pre">allsembly.speech_act.ChainArgument</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.ChainArgument" title="Permalink to this definition">¶</a></dt>
<dd><p>An chain of arguments to be paired with a position.
Since it doesn’t give its target.  The target can
be implicit: whatever it is paired with.
So the chain of arguments can be constructed
recursively.
A user might want to support their asserts with
complex chains of arguments.  That way they can
ensure that the value of their assertions from the start
reflects the chain of support that they know about.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.ExistingPosition">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">ExistingPosition</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">position_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.ExistingPosition" title="Permalink to this definition">¶</a></dt>
<dd><p>A position already entered into the graph.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.HypotheticalPremise">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">HypotheticalPremise</span></code><a class="headerlink" href="#allsembly.speech_act.HypotheticalPremise" title="Permalink to this definition">¶</a></dt>
<dd><p>Not implemented yet.
A normal bid of support has to be greater than 50 ‘cents’
of a ‘dollar’, indicating support and not indifference
(i.e., &gt; 50% confidence).
Confidence in a HypotheticalPremise has to be greater
than that in any of its mutually exclusive alternatives,
expressing a belief that it is the best candidate for
truth, so far, among the alternatives.
Therefore, asserting a HypotheticalPremise entails
stating what the mutually exclusive alternatives are
and disclosing one’s level of confidence for all
but one of them.  It must be consistent with all of them
possibly summing to one (when each has a value between
zero and one), and the asserted premise must have
the largest confidence value among the alternatives.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.IndependentBid">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">IndependentBid</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_price</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_price</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">market_locator</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.MarketLocator" title="allsembly.speech_act.MarketLocator"><span class="pre">allsembly.speech_act.MarketLocator</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">pro_or_con</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.ProOrCon" title="allsembly.speech_act.ProOrCon"><span class="pre">allsembly.speech_act.ProOrCon</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.IndependentBid" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents an offer to buy a bidding contract
specifically pro or con a specific position.
Bid prices should be between 0 and 1 in certain
increments (e.g., .001).</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.InitialPosition">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">InitialPosition</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conclusion</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">premises</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.Premise" title="allsembly.speech_act.Premise"><span class="pre">allsembly.speech_act.Premise</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#allsembly.speech_act.ChainArgument" title="allsembly.speech_act.ChainArgument"><span class="pre">allsembly.speech_act.ChainArgument</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.InitialPosition" title="Permalink to this definition">¶</a></dt>
<dd><p>In an inquiry dialogue, these will be the same as arguments,
but they will have an explicit conclusion
rather than a target, and premises are optional.
In a deliberation, these will be either action proposals
or evaluation criteria.
For now, no bid is required on an initial position.
If it is in an inquiry dialogue, there will probably be only
one initial position.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.MarketLocator">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">MarketLocator</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.MarketLocator" title="Permalink to this definition">¶</a></dt>
<dd><p>Issue id and position id, needed
to locate a market within the betting exchange</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.Premise">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">Premise</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bid_on_statement</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.Bid" title="allsembly.speech_act.Bid"><span class="pre">allsembly.speech_act.Bid</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.Premise" title="Permalink to this definition">¶</a></dt>
<dd><p>An ordinary premise.
A commitment in the form of a bid is required to assert
an ordinary premises.  That expresses that the user
has confidence in the premise.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.ProOrCon">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">ProOrCon</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.ProOrCon" title="Permalink to this definition">¶</a></dt>
<dd><p>An enumeration.</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.ProposeSpeechAct">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">ProposeSpeechAct</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">initial_position</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#allsembly.speech_act.InitialPosition" title="allsembly.speech_act.InitialPosition"><span class="pre">allsembly.speech_act.InitialPosition</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.ProposeSpeechAct" title="Permalink to this definition">¶</a></dt>
<dd><p>Request for adding an InitialPosition to the
argument graph</p>
</dd></dl>

<dl class="py class">
<dt id="allsembly.speech_act.UnconcededPosition">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">allsembly.speech_act.</span></code><code class="sig-name descname"><span class="pre">UnconcededPosition</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">position_id</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#allsembly.speech_act.UnconcededPosition" title="Permalink to this definition">¶</a></dt>
<dd><p>A position that is already in the graph.
When it is used as a premise, no bid is required.
Participants may use other participants’
premises in their arguments even when they do
not believe them to be true.
This is necessary for participants to make reductio
style arguments and draw out contradictions in others’
positions.</p>
</dd></dl>

</div>
</div>
<div class="section" id="future-design">
<h2>Future design<a class="headerlink" href="#future-design" title="Permalink to this headline">¶</a></h2>
<div class="section" id="design-for-confidentiality">
<h3>Design for confidentiality<a class="headerlink" href="#design-for-confidentiality" title="Permalink to this headline">¶</a></h3>
<p><em>This section and the next two sections, “Design for integrity” and “Design for scalability” describe features that are not expected to be added to the prototype.  They would be added later, in a stage of development beyond the prototype.  But they contain important ideas to keep in mind while developing the prototype.</em></p>
<img alt="_images/anonymity_preserving_registration.svg" src="_images/anonymity_preserving_registration.svg" /><p>The figure above shows a design with a separate server for login and a separate
server for registration, which could be hosted by different organizations.
The organization hosting the Registration server verifies the new user’s
identity but never sees the user’s userid or passwords; those are encrypted
on the client side using the public key of the organization hosting the
login server.</p>
<p>The basic idea is that records containing the userid and records containing
the personally identifying information (PII) are not connected by any
common fields, and cannot be connected without the private key of the ID
guardian.  (One can imagine the ID guardian as a law firm with it’s private
key stored offline in a vault or something or escrow service that is somehow
contractually bound not decrypt the userid field in a database record provided
to it from the registration database by the registering organization without,
say, a court issued warrant.)</p>
<p>The idea does not necessarily require multiple organizations or servers and
separate DBMSes, though.  It can be accomplished in a single database managed
by one DBMS.  A record in the login table contains, e.g., userid and password.
A record in the registration database contains, e.g., real name, email address,
phone number, address, etc., and encrypted userid (that was encrypted by the
client’s device before it reached the server and that can only be decrypted
using the private key held offline).</p>
<p>The flow is as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>User connects to the registration server and provides personally identifying information that will be used to verify their identity and provides a desired userid that is encrypted with a public key of the login server (the Allsembly™ server).  The corresponding private key is stored unencrypted on the login server.</p></li>
<li><p>The registration server sends only the encrypted userid and password to the login server.</p></li>
<li><p>The login server informs the registration server whether the userid is unique.  If it is not, then the registration server informs the user to select a new userid.</p></li>
<li><p>If the userid is unique, the login server stores the userid and password in its login database (table) with a flag indicating that it is not yet activated (because the user has not yet been verified).</p></li>
<li><p>The registration server discards the encrypted password and further encrypts the already encrypted userid with the public key of the ID guardian.  It stores this encrypted userid with the PII in the registration database (table). (The encrypted userid should not be able to be compared with a the same userid encrypted with the same key at a different time.  Therefore, this saved userid might have been separatedly encrypted from the one sent to the login server, with a different random padding.)</p></li>
<li><p>The next step is not fully worked out.  It involves passing a token that proves that the user has been verified.  It possibly involves cryptographic signatures and is done in such a way that neither the login server nor the registration server may use its counterpart to send arbitrary encrypted  messages to the user.  (Imagine that there is limited trust between them.)</p></li>
<li><p>After the user has been verified, the user logs in to the login server.</p></li>
</ol>
</div></blockquote>
<p>Subsequently, the user uses the login server to change their password.  (Or the client might log in to both servers to change passwords, separately on both,
in such a way that it only requires one step for the user.)</p>
<p>If the user needs to change their PII, they log in to the registration
server using their email adress.  (They could potentially use the same
password hashed and salted differently.)</p>
<p>To enable recovery of a forgotten userid, userid could be stored by the registration server (or in the registration database) encrypted with the user’s password.  The password is not stored bythe registration server, except possibly in hashed form, so the userid is encrypted using the password hashed with a different algorithm and/or parameters. In that case, the user logs into the registration server using email address and password; then, the registration server sends the encrypted userid to the user who decrypts it client-side.</p>
<p>There seems to be no way to recover a forgotten password without temporarily breaching anonymity for that user.  Although the user has both email address and userid, the user cannot authenticate with the login server using an email address without connecting the identities, so password reset via email would only get a user access to their profile on the registration server.</p>
<p>If the ID guardian is a separate person/organization from the organization
hosting the login server, then the representatives of both organizations
are needed to revoke anonymity.</p>
<p>NOTE: THIS IS NOT A PROOF.  THERE COULD BE IMPORTANT FLAWS IN THIS APPROACH.</p>
<p>However, I believe the approach has the following desirable properties:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Attacker cannot learn identities of users by listening to traffic between client and server, without other information.</p></li>
<li><p>Attacker cannot learn identities of users by obtaining either or both databases (tables).</p></li>
<li><p>Attacker cannot learn the identities of existing users by controlling either or both servers.  (Such an attacker can only learn identities of new registrants andd users resetting their passwords.)</p></li>
</ol>
</div></blockquote>
<p>An additional issue for confidentiality is the connection of bets on
positions to userids.  To prevent a whole profile of a user’s argumentative
commitments being built up by an attacker, ids used to match users with betting contracts can be anonymized.  The list of anonymized ids that correspond to a
userid can be maintained as an encrypted field in the database table containing
user information.  The encryption key can be the user’s password itself
hashed in a different way and with a different salt than the one stored
for login.  So, when a user logs in they send both hashes.  The server
decrypts the anonymized ids field and caches it for a while to provide
the services to the user.  It remains encrypted at-rest and anytime the
user logs out or the cache expires.</p>
</div>
<div class="section" id="design-for-integrity">
<h3>Design for integrity<a class="headerlink" href="#design-for-integrity" title="Permalink to this headline">¶</a></h3>
<p><em>This section describes features that are not expected to be added to the prototype.  They would be added later, in a stage of development beyond the prototype.  But it contains important ideas to keep in mind while developing the prototype.</em></p>
<p>To provide accountability that the data stored on the server matches the
users’ activities, the server should send cryptographically signed receipts
for bids, asks, and betting contract purchases and sales.</p>
<p>The client can store them in local memory and can also store pending
transactions to re-send in case it does not get a confirmation receipt.</p>
<p>Likewise, users should not be able to repudiate their orders or betting contracts.  So, those should be cryptographically signed by users as well.</p>
</div>
<div class="section" id="design-for-scalability">
<h3>Design for scalability<a class="headerlink" href="#design-for-scalability" title="Permalink to this headline">¶</a></h3>
<p><em>This section describes features that are not expected to be added to the prototype.  They would be added later, in a stage of development beyond the prototype.  But it contains important ideas to keep in mind while developing the prototype.</em></p>
<p>The current design was not made for massive scalability.  This section is
just to add information about what can be done to scale the existing design
without extensive changes.</p>
<p>First of all different database backends can be dropped in as replacements.
The ZODB API supports ZEO, which is a multi-process available, networkable
DBMS.  It also supports a “Relstorage” backend, which allows for storage in
SQL databasaes such as MySQL, PostgreSQL, and commercial enterprise-scale
SQL DBMSes.  However, it still stores the objects pickled.
An alternative would be to use an SQL DBMS through an object-relational
mapper (ORM) to possibly eek out some better concurrency.  It might not
be necessary to do that, though.</p>
<p>Python does not provide thread parallelism.  I assume that I will eventually
have to replace Problog, maybe with custom code.  A promising possibility may
be to use iterative join-graph probagation (IGJP), which is an “anytime”
algorithm for evaluating Bayesian Networks.  At each iteration, it gets
closer to the exact solution.  So, the graph could be updated with the
approximate values computed so far until the algorithm converges on the
solution.  There is an existing open source implementation in a
software package called <a class="reference external" href="https://github.com/radum2275/merlin/">“merlin”</a>.
It could be integrated into the Allsembly server.  It is single threaded.
However, I would like to investigate parallelizing the algorithm.  There
is a dependency of a node on the node from which it receives a message
in IJGP (and in other message passing belief propagation algorithms).
But it seems like there would be many graphs that would have multiple
semi-independent paths parts of which could have their calculations
independently computed by separate worker threads.</p>
<p>Other than that, I would
propose parallelising the Allsembly™ server using separate processes, with
each process handling one or more complete issues (whole argument graphs).
The separate processes would have to coordinate with regard to users needing
to participate in issues–a user may participate on multiple issues overlapping
in time–being handled in another process or being handled in multiple
processes.</p>
<p>Such changes, which are not too extensive with regard to modifications to
the existing design, might enable a lot of scalability and be sufficient for
the Allsembly™ project beyond the prototype.  Massive scalabily could be
part of a separate (we could hope funded) project if it, at some point,
becomes a widely used piece of software.</p>
</div>
<div class="section" id="localization">
<h3>Localization<a class="headerlink" href="#localization" title="Permalink to this headline">¶</a></h3>
<p>UPDATE: Part of this can be handled using Django.  More information
to be added.  I would still like to use XML in order to give clients
more control over the presentation, but XML containing the translated
strings can be generated by Django.  The default XSL can also be
generated by Django, but in advance, rather than on-the-fly.</p>
<p>My current intention is to implement localization by putting the strings
in XML files and using XSLT transforms to select the appropriate
string and to combine it with any dynamic data.</p>
<p>The Accept-Language header or the user’s language selection (stored
in a cookie or embodied in a special path, such as /en/file.xml)
can be used to select the appropriate string.</p>
<p>Directives in XML tags can encode the correct way to transform
dynamic data or other words in the text that are dependent on the dynamic
data.</p>
<p>For example, if the dynamic data is a number, another word might have
to be sometimes singular and sometimes plural:</p>
<p>“You have x token(s) remaining.”</p>
<p>Sometimes there might be special words when the number is 2 or 3.</p>
<p>Sometimes words might need to be marked with affixes or suffixes to do
with grammatical role.</p>
<p>These things could be accomodated with regular expressions and XSLT
regular expression functions.  The same or similar methods can be
used to accommodate differences in date, time, and number formats
or separators between items in sequences.  Alternatively, some format
preferences could be handled using special code in the server.
For example, the server could be given the user’s preference for
probabilities as decimal values or percentages and preference for
dot or comma separating the whole and fractional parts of a number,
etc., and the server would thenceforth produce probabilities that way,
or it could be handled with XSLT and (possibly complex) regular expressions
or conditionals.</p>
<p>Benefits of this approach could be:</p>
<ul class="simple">
<li><p>XML and XSLT processing are built into web browsers.</p></li>
<li><p>Javascript isn’t required (but could be used).</p></li>
<li><p>XML schemas could validate the documents using readily available tools</p></li>
<li><p>XML is a commonly used standard.  The developer might already know it;
otherwise, it may be useful to learn and reuseable knowledge.</p></li>
</ul>
</div>
</div>
<div class="section" id="project-development-roadmap">
<h2>Project development roadmap<a class="headerlink" href="#project-development-roadmap" title="Permalink to this headline">¶</a></h2>
<div class="section" id="accessibility-basics">
<h3>Accessibility basics<a class="headerlink" href="#accessibility-basics" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Add text description to SVG diagram of the dialogue graph that describes the graph structure.</p></li>
<li><p>Add keyboard controls for zooming and panning the SVG image.</p></li>
<li><p>Maintain the page layout reasonably when the page is scaled with ctrl-+/-.</p></li>
</ul>
</div>
<div class="section" id="core-features">
<h3>Core features<a class="headerlink" href="#core-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Enable a user to reuse existing positions to support or oppose other arguments.</p></li>
<li><p>Enable a user to mark two or more positions as the same or as mutually exclusive (the “Relate” feature).</p></li>
<li><p>Enable a user to add posts to a per-position informal discussion (the “Discuss” feature).</p></li>
<li><p>Implement the betting markets, including the order book, the matchin algorithm, and the ledger of bids and betting contracts.</p></li>
<li><p>Enable the (re-)selling of existing betting contracts.</p></li>
<li><p>Implement detection of inconsistent bids and bets and prevent users from making such.</p></li>
<li><p>Implement detection of inconsistencies in other commitments (as the result of reductio arguments and some “Relate” actions) and enable users to resolve inconsistencies by selling betting contracts.</p></li>
<li><p>Enable topic proposal.</p></li>
<li><p>Enable users to interact on the same dialogues (not only single user sanboxes and simulated multi-user activity).</p></li>
<li><p>Add policy proposals as the initial position type and add a policy evaluation positon type and the other policy decision features.</p></li>
<li><p>(For possible inclusion in the prototype:) Add encryption of anonymous IDs that connect a user to their bids and bets in the ledger.</p></li>
<li><p>(For possible inclusion in the prototype:) Add asymmetric encryption of userids in a registration record to prevent its connection with user login records, as described under <a class="reference internal" href="#design-for-confidentiality"><span class="std std-ref">Design for confidentiality</span></a>.  If this is added in the prototype, it will be an optional feature and only use a single public key, not two.</p></li>
</ul>
</div>
<div class="section" id="demo-features">
<h3>Demo features<a class="headerlink" href="#demo-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Enable deletion of positions.</p></li>
<li><p>Add a guest login option.</p></li>
<li><p>Allow a user to simulate multiple users by selecting the current user from a dropdown menu.</p></li>
</ul>
<p>More to be added to this section, including categorizing items as short-, medium-, or long-term and possibly including beyond-the-prototype items, later.</p>
</div>
</div>
<div class="section" id="coding-standards">
<h2>Coding standards<a class="headerlink" href="#coding-standards" title="Permalink to this headline">¶</a></h2>
<p>NOTE: This project is uses typed Python.  The mypy settings are in the
file setup.cfg.  It uses all of the settings from <code class="docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--strict</span></code>
(as of mypy version 0.812) except <code class="docutils literal notranslate"><span class="pre">--disallow-subclassing-any</span></code>, which
is not used (especially) since some classes subclass “Persistent” in order
to take advantage of the ZODB database.</p>
<p>The modules may be type-checked using the following command from the
command line from within the main directory of the project:
<code class="docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">allsembly/*.py</span></code>.  It should report no errors.</p>
<p>For more information about mypy or about optional type-checking in Python,
see <a class="reference external" href="http://mypy-lang.org">http://mypy-lang.org</a>.</p>
<p>Mypy may be installed with: <code class="docutils literal notranslate"><span class="pre">python3.7</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">mypy</span></code>.</p>
<p>Settings for Pylint (see <a class="reference external" href="https://pylint.org">https://pylint.org</a>) are also in the setup.cfg file.
With Pylint installed, the modules may be linted by running Pylint from the
command line as follows:
<code class="docutils literal notranslate"><span class="pre">pylint</span> <span class="pre">--rcfile=setup.cfg</span> <span class="pre">allsembly</span></code>.</p>
<p>The Pylint settings in setup.cfg correspond to:
<code class="docutils literal notranslate"><span class="pre">pylint</span> <span class="pre">--disable=all</span> <span class="pre">-enable</span> <span class="pre">F,E,W</span> <span class="pre">--disable=python3</span></code>.
This will report many warnings, mostly about unused variables and two
errors about imports.  The errors are false positives as far as I can
tell.  The module is successfully using the imported class (OOBTree).
I plan to attend to the warnings.
I also look at the output of the refactoring module even though it
is disabled in setup.cfg, and I plan to implement some of its refactoring
recommendations.</p>
<div class="section" id="guidelines">
<h3>Guidelines<a class="headerlink" href="#guidelines" title="Permalink to this headline">¶</a></h3>
<p>Python:</p>
<ul class="simple">
<li><p>In the server modules, don’t use exceptions and don’t allow exceptions to escape your functions (it is okay in scripts).  Unhandled exceptions could be the source of unplanned server termination that could affect data integrity or worsen user experience even though the server can be restarted.  I will be reviewing the “returns” Python library to help with this in the future.</p></li>
<li><p>Avoid the use of variables when possible and reasonable and annotate variables as “Final” whenever they do not need to be reused.  Reuse few variables.</p></li>
<li><p>Avoid unnecessary references.  I am considering the “Pysistent” Python library to help with this in the future.</p></li>
<li><p>Make use of the context manager (“with …:” blocks) for resource managemant.</p></li>
<li><p>Mark private data and functions with a leading underscore (Pylint will catch unintended uses).</p></li>
<li><p>Use all caps for constants (Pylint will catch unintended uses).</p></li>
<li><p>Use docstrings to document all modules, classes, and nontrivial functions.</p></li>
</ul>
<p>JavaScript:</p>
<ul class="simple">
<li><p>Use only as much JavaScript as necessary.</p></li>
<li><p>Prefer declarative code to imperative whenever imperative code is not needed to provide a significant advantage.</p></li>
<li><p>Use comments to document all files and nontrivial classes and functions.</p></li>
</ul>
<p>Other languages:</p>
<p>Adopt similar guidelines.</p>
<p>Secure coding:</p>
<p>See the “OWASP Secure Coding Practices Quick Reference Guide” at:
<a class="reference external" href="https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/migrated_content">https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/migrated_content</a></p>
<p>Choosing library dependencies:</p>
<ul class="simple">
<li><p>Choose the most widely uses and respected libraries for encryption.</p></li>
<li><p>For other purposes, choose more or less production ready libraries.</p></li>
</ul>
</div>
</div>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>For now, see <a class="reference external" href="https://github.com/waleedmebane/allsembly-prototype/blob/main/docs/how_it_works.md">docs/how_it_works.md</a> in the
<a class="reference external" href="https://github.com/waleedmebane/allsembly-prototype">source code repository</a>.</p>
</div>
<div class="section" id="other-uses">
<h2>Other uses<a class="headerlink" href="#other-uses" title="Permalink to this headline">¶</a></h2>
<p>For example, the software could be adapted to provide a way for writers
to distribute bounties to people who help to improve their writing by
finding shortcomings in the reasoning.  Aside from adapting the code, if one
wants to use it in such a way, one needs to be cognizant of any laws in one’s
jusrisdiction restricting <em>contests</em>, including ones that contain an element
of chance.</p>
<p>Individuals or small groups could provide bounties for a recommended resolution
of some disagreement.</p>
<p>Private groups could use it without bounties to deliberate among themselves.
If any money is exchanged, for example, grafting a parimutuel betting scheme
onto the betting market aspect of the software, then one needs to be cognizant
of any laws in one’s jusrisdiction restricting <em>gambling</em>, and possibly also
laws in the jurisdictions of each of the participants if those are different.</p>
<p>While Allsembly™ as a community is intended to be independent in the sense
of participants choosing their own issues to dialogue about, the software
could also be adapted for public consultation in which issues and possibly
some other parameters for the dialogue are decided by the organization seeking
the policy recommendation to be generated through the dialogue.</p>
<p>It could be used for opinion research in conjunction with opinion polls,
e.g., by comparing opinion before and after deliberation (as with Deliberative
Polling®) or by comparing the recommendation yielded by deliberation (if any)
with an opinion poll result.</p>
<p>It could be used for argumentation or AI research by mining (only completely anonymous) data, such as for training an artifical agent how to argue or deliberate
based on the activity of the human participants.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Allsembly™ Prototype</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation_and_testing.html">Installation and Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_s_guide.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Programmer’s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#future-possible-dependencies">Future possible dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#files">Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specification-of-requirements-draft">Specification of requirements (draft)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design-overview">Design overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#class-detail">Class detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="#future-design">Future design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-development-roadmap">Project development roadmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="#coding-standards">Coding standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-uses">Other uses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">GNU Free Documentation License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="user_s_guide.html" title="previous chapter">User’s Guide</a></li>
      <li>Next: <a href="license.html" title="next chapter">GNU Free Documentation License</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, 2023 Waleed H. Mebane.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/programmer_s_guide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>